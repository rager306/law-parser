# Надежность LDUP v5

## 1. Защитные механизмы

### 1.1. Rate Limiting (LLM API)
Для предотвращения блокировок со стороны провайдеров внедряется:
*   **Библиотека:** `tenacity`.
*   **Логика:** Retry при ошибках 429/5xx с экспоненциальной задержкой.
*   **Semaphore:** Ограничение числа параллельных запросов до `N` (настраивается под лимиты ключа).

### 1.2. TCGR Recursion Guard
Рекурсивные запросы изменений в SQLite защищены:
*   **LIMIT depth:** Максимальная глубина графа в CTE-запросе — 10 (достаточно для ФЗ).
*   **Cycle Detection:** Использование `UNION` вместо `UNION ALL` для автоматического подавления циклов.

### 1.3. LLM Fallback
При сбое основного API:
1.  Попытка 1-3 через `tenacity`.
2.  Автоматическое переключение на резервную модель (через абстракцию LiteLLM).
3.  Пометка факта как `low_confidence`.

## 2. HCO Cache Versioning
Кэш семантических блоков содержит поле `algo_version`. При изменении логики суммаризации или модели эмбеддингов, система может инвалидировать старые записи избирательно.